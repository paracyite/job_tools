#!/usr/bin/env bash
set -euo pipefail

CSS="$HOME/.config/job_tools/Templates/resumecss.css"
DEST="$HOME/Documents/JOB_APPLICATIONS"

source ~/.config/job_tools/configuration.txt
source ~/.config/job_tools/data.txt
cd "$DEST"

ROLE=$(echo "$APPLIED_ROLE" | tr '[:lower:]' '[:upper:]' | tr -s ' ' '_')

# Find the actual files — no tricks
RESUME_MD=$(ls Louis_Pantuso_*.md 2>/dev/null | grep -iv cover | head -n1)
COVER_MD=$(ls Louis_Pantuso_*.md 2>/dev/null | grep -i cover  | head -n1)

echo "Role → $ROLE"
echo "Resume  → $RESUME_MD"
echo "Cover   → $COVER_MD"
echo

# RESUME — perfect as always
[[ -n "$RESUME_MD" ]] && {
    echo "Generating Resume..."
    pandoc "$RESUME_MD" --css="$CSS" --pdf-engine=weasyprint \
        -o "Louis_Pantuso_${ROLE}_Resume.pdf" && echo "Resume: DONE"
}

# COVER LETTER — just convert the already-perfect markdown
[[ -n "$COVER_MD" ]] && {
    echo "Generating Cover Letter..."
    pandoc "$COVER_MD" --standalone --css="$CSS" --pdf-engine=weasyprint \
        -o "Louis_Pantuso_${ROLE}_Cover_Letter.pdf" && echo "Cover Letter: DONE"
}

echo
echo "FINISHED — both PDFs perfect and up-to-date:"
ls -lt Louis_Pantuso_*_Resume.pdf Louis_Pantuso_*_Cover_Letter.pdf 2>/dev/null | head -5
