#!/bin/bash
set -euo pipefail

cd "$HOME/Documents/JOB_APPLICATIONS"

source "$HOME/.config/job_tools/configuration.txt"
source "$HOME/.config/job_tools/data.txt"

# Your resumeWrite uses UPPERCASE role
ROLE_UPPER=$(echo "${APPLIED_ROLE:-Generic}" | tr '[:lower:]' '[:upper:]' | tr -s ' ' '_')

# Your CoverGen uses lowercase role
ROLE_LOWER=$(echo "${APPLIED_ROLE:-Generic}" | tr '[:upper:]' '[:lower:]' | tr -s ' ' '_')

# Exact filenames your two scripts actually create
RESUME_MD="${NAME_FIRST}_${NAME_LAST}_${ROLE_UPPER}.md"
COVER_MD="${NAME_FIRST}_${NAME_LAST}_${ROLE_LOWER}_Cover_Letter.md"

RESUME_PDF="${NAME_FIRST}_${NAME_LAST}_${ROLE_UPPER}_Resume.pdf"
COVER_PDF="${NAME_FIRST}_${NAME_LAST}_${ROLE_LOWER}_Cover_Letter.pdf"

# Regenerate fresh files
~/Bash/job_tools/resumeWrite
~/Bash/job_tools/CoverGen

# Compile — full paths, no tricks
pandoc "$RESUME_MD" \
    --template="$HOME/.config/job_tools/Templates/resume.tex" \
    --pdf-engine=xelatex \
    -o "$RESUME_PDF"

pandoc "$COVER_MD" \
    --template="$HOME/.config/job_tools/Templates/cover-letter.tex" \
    --pdf-engine=xelatex \
    -o "$COVER_PDF"

echo "DONE — PDFs created:"
ls -lh "$RESUME_PDF" "$COVER_PDF"
