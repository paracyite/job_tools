#!/bin/bash
set -euo pipefail

CONFIG_DIR="${XDG_CONFIG_HOME:-$HOME/.config}/job_tools"
mkdir -p "$CONFIG_DIR" "$HOME/Documents/JOB_APPLICATIONS"

source "$CONFIG_DIR/configuration.txt"
source "$CONFIG_DIR/data.txt"

# Default if unset
APPLIED_ROLE="${APPLIED_ROLE:-Generic}"

ROLE_CLEAN=$(echo "$APPLIED_ROLE" | tr '[:lower:]' '[:upper:]' | tr -s ' ' '_')

if [[ -z "$ROLE_CLEAN" ]]; then
    echo "ERROR: APPLIED_ROLE is empty—set it in data.txt or run tailor.txt." >&2
    exit 1
fi

FILE="$HOME/Documents/JOB_APPLICATIONS/${NAME_FIRST}_${NAME_LAST}_${ROLE_CLEAN}.md"

cat > "$FILE" << EOF
---
name: ${NAME_FIRST} ${NAME_LAST}
address: ${CITY}, ${STATE}
phone: ${PHONE}
email: ${EMAIL}
---


${SUMMARY}

\heading{Professional Experience}
\jobtitle{${CURRENT_JOB_POSITION}}
${CURRENT_JOB} - ${CURRENT_JOB_CITY}, ${CURRENT_JOB_STATE} \hfill ${CURRENT_START_YEAR} – ${CURRENT_END_YEAR}

- ${CURRENT_JOB_BULLET_ONE}

- ${CURRENT_JOB_BULLET_TWO}

- ${CURRENT_JOB_BULLET_THREE}

\jobtitle{${SECOND_JOB_POSITION}}
${SECOND_JOB} - ${SECOND_JOB_CITY}, ${SECOND_JOB_STATE} \hfill ${SECOND_START_YEAR} – ${SECOND_END_YEAR}

- ${SECOND_JOB_BULLET_ONE}

- ${SECOND_JOB_BULLET_TWO}

- ${SECOND_JOB_BULLET_THREE}

\jobtitle{${THIRD_JOB_POSITION}}
${THIRD_JOB} - ${THIRD_JOB_CITY}, ${THIRD_JOB_STATE} \hfill ${THIRD_START_YEAR} – ${THIRD_END_YEAR}

- ${THIRD_JOB_BULLET_ONE}

- ${THIRD_JOB_BULLET_TWO}

- ${THIRD_JOB_BULLET_THREE}



\heading{Skills \& Other}

- ${SKILLS_ONE}

- ${SKILLS_TWO}

- ${SKILLS_THREE}

- ${SKILLS_FOUR}

- ${SKILLS_FIVE}

- ${SKILLS_SIX}

- ${SKILLS_SEVEN}

- ${SKILLS_EIGHT}

EOF

echo "Resume generated perfectly → $(basename "$FILE")"
